import{createCircle,createCross}from"./utils.js";import"../assets/styles/style.css";let matrixData=[["*","*","*"],["*","*","*"],["*","*","*"]];const storedMatrixData=localStorage.getItem("matrixData"),storedCrossScore=localStorage.getItem("crossScoreData"),storedCircleScore=localStorage.getItem("circleScoreData"),storedDrawScore=localStorage.getItem("drawScoreData");let turn=0,crossScore=0,circleScore=0,drawScore=0;const matrixContainer=document.querySelector(".matrix__container"),newGameButton=document.querySelector(".matrix__button"),winner=document.querySelector(".matrix__winner"),labelOptions=document.querySelectorAll(".matrix__option__item__label"),humanOptions=document.querySelector(".matrix__option__item__human"),aiOptions=document.querySelector(".matrix__option__item__ai"),crossPoint=document.querySelector(".cross__point"),circlePoint=document.querySelector(".circle__point"),drawPoint=document.querySelector(".draw__point"),putMark=(t,e,r)=>{if(turn<9&&humanOptions.checked){let a="0";turn%2==0?(a="x",t.appendChild(createCross()),console.log(turn)):(a="0",t.appendChild(createCircle()),console.log(turn)),matrixData[e][r]=a,localStorage.setItem("matrixData",JSON.stringify(matrixData)),turn+=1,checkWinConditions()}},renderingTurn=t=>{for(let e=0;e<t.length;e++)for(let r=0;r<t.length;r++){let a=document.querySelector('.cell[data-row="'.concat(e,'"][data-col="').concat(r,'"]'));"*"!=t[e][r]&&("0"==t[e][r]?a.appendChild(createCircle()):"x"==t[e][r]&&a.appendChild(createCross()))}},putMarkAI=(t,e,r)=>{if(turn<9&&aiOptions.checked){let a="x";turn%2==0&&(matrixData[e][r]=a,localStorage.setItem("matrixData",JSON.stringify(matrixData)),t.appendChild(createCross()),makeAIMove(a)),turn+=1,checkWinConditions(),console.log(matrixData)}},freeСells=()=>{let t=[];for(let e=0;e<matrixData.length;e++)for(let r=0;r<matrixData.length;r++)"*"==matrixData[e][r]&&t.push([e,r]);return t};function makeAIMove(t){const e=freeСells();if(e.length>0){const t=Math.floor(Math.random()*e.length),[r,a]=e[t];let o=document.querySelector('.cell[data-row="'.concat(r,'"][data-col="').concat(a,'"]'));turn+=1,matrixData[r][a]="0",localStorage.setItem("matrixData",JSON.stringify(matrixData)),o.appendChild(createCircle())}}const newGame=()=>{const t=document.querySelectorAll(".cell");for(let t=0;t<matrixData.length;t++)for(let e=0;e<matrixData.length;e++)matrixData[t][e]="*";localStorage.setItem("matrixData",JSON.stringify(matrixData)),t.forEach((t=>{for(;t.firstChild;)t.removeChild(t.firstChild)})),turn=0,winner.innerText=""};function checkWin(t,e){for(let r=0;r<3;r++)if(t[r][0]===e&&t[r][1]===e&&t[r][2]===e||t[0][r]===e&&t[1][r]===e&&t[2][r]===e)return!0;return t[0][0]===e&&t[1][1]===e&&t[2][2]===e||t[0][2]===e&&t[1][1]===e&&t[2][0]===e}const checkWinConditions=()=>{checkWin(matrixData,"x")?(winner.innerText="Крестики победили!",crossScore+=1,localStorage.setItem("crossScoreData",crossScore),crossPoint.innerText=crossScore,turn=9):checkWin(matrixData,"0")?(winner.innerText="Нолики победили!",circleScore+=1,localStorage.setItem("circleScoreData",circleScore),circlePoint.innerText=circleScore,turn=9):(9==turn&&(winner.innerText="Ничья!",drawScore+=1,localStorage.setItem("drawScoreData",drawScore),drawPoint.innerText=drawScore),console.log("Продолжаем игру..."))};for(let t=0;t<matrixData.length;t++)for(let e=0;e<matrixData.length;e++){const r=document.createElement("div");r.className="cell",r.dataset.row=t,r.dataset.col=e,matrixContainer.appendChild(r),r.addEventListener("click",(function(){const t=parseInt(this.dataset.row,10),e=parseInt(this.dataset.col,10);humanOptions.checked&&"*"==matrixData[t][e]?putMark(this,t,e):aiOptions.checked&&"*"==matrixData[t][e]&&putMarkAI(this,t,e)}))}newGameButton.addEventListener("click",(t=>{t.preventDefault(),newGame()})),labelOptions.forEach((t=>{t.addEventListener("click",(()=>{labelOptions.forEach((t=>{t.classList.remove("active")})),t.classList.add("active"),newGame()}))})),storedMatrixData?(matrixData=JSON.parse(storedMatrixData),renderingTurn(matrixData)):matrixData=[["*","*","*"],["*","*","*"],["*","*","*"]];const getStoreScore=(t,e,r)=>(t?(e=Number(t),r.innerText=e):(e=0,r.innerText=e),e);crossScore=getStoreScore(storedCrossScore,crossScore,crossPoint),circleScore=getStoreScore(storedCircleScore,circleScore,circlePoint),drawScore=getStoreScore(storedDrawScore,drawScore,drawPoint);